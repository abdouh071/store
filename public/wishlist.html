<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="View your saved items and wishlist at Clothing Store."/>
  
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="My Wishlist - Clothing Store">
  <meta property="og:description" content="View your saved items and wishlist at Clothing Store.">
  
  <title>My Wishlist - Clothing Store</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="nav-search.css">
  <link rel="stylesheet" href="mobile-store-style.css">
  <script src="translations.js"></script>
  <style>
    .wishlist-container {
      max-width: 1400px;
      margin: 40px auto;
      padding: 0 5%;
      min-height: 60vh;
    }

    .wishlist-header {
      margin-bottom: 40px;
      text-align: center;
    }

    .wishlist-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 10px;
    }

    .wishlist-header p {
      color: #666;
    }

    .wishlist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 30px;
    }

    .empty-wishlist {
      text-align: center;
      padding: 60px 20px;
      background: #f9f9f9;
      border-radius: 20px;
    }

    .empty-wishlist h3 {
      font-size: 1.5rem;
      margin-bottom: 16px;
      color: #333;
    }

    .empty-wishlist p {
      color: #666;
      margin-bottom: 24px;
    }

    .btn-primary {
      background: #111;
      color: #fff;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      display: inline-block;
      transition: all 0.3s;
    }

    .btn-primary:hover {
      background: #333;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay"></div>

  <!-- Navbar -->
  <header class="navbar">
    <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">☰</button>
    <a href="/" class="logo">Clothing Store</a>
    
    <!-- Search Bar -->
    <div class="nav-search-container">
      <input type="text" class="nav-search-input" placeholder="Search for products..." id="navSearchInput" data-i18n-placeholder="search_placeholder">
      <div class="nav-search-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      </div>
    </div>

    <nav class="nav-links" id="navLinks">
      <div class="sidebar-header">
        <span class="sidebar-logo">Clothing Store</span>
        <button class="close-menu" id="closeMenu" aria-label="Close menu">×</button>
      </div>
      <a href="index.html" data-i18n="home">Home</a>
      <a href="contact.html" data-i18n="contact">Contact</a>
      <a href="history.html" data-i18n="my_history">My History</a>

      <!-- Language Switcher -->
      <div class="language-switcher" style="display: flex; align-items: center; gap: 8px; margin: 0 10px;">
        <button id="langEn" class="lang-btn active" onclick="switchLanguage('en')">EN</button>
        <span style="color: var(--secondary-color); opacity: 0.5;">|</span>
        <button id="langAr" class="lang-btn" onclick="switchLanguage('ar')">AR</button>
      </div>

      <a href="wishlist.html" class="wishlist-icon active" title="Wishlist">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
        <span class="wishlist-badge" style="display: none;">0</span>
      </a>
      <span class="theme-toggle" id="themeToggle" title="Toggle Dark Mode" style="cursor: pointer; font-size: 1.2rem;">
        <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
      </span>
      <span class="cart-icon" id="cartIcon" title="Shopping Cart">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
        <span class="cart-badge" id="cartBadge" style="display: none;">0</span>
      </span>
    </nav>
  </header>

  <main class="wishlist-container">
    <div class="wishlist-header">
      <h1 data-i18n="my_wishlist">My Wishlist</h1>
      <p data-i18n="wishlist_desc">Your saved items for later</p>
    </div>

    <div class="wishlist-grid" id="wishlistGrid">
      <!-- Items will be injected here -->
    </div>
  </main>

  <!-- Bottom Navigation (Mobile Only) -->
  <nav class="bottom-nav">
    <a href="index.html" class="bottom-nav-item">
      <span class="bottom-nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></span>
      <span data-i18n="home">Home</span>
    </a>
    <a href="store.html" class="bottom-nav-item">
      <span class="bottom-nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg></span>
      <span data-i18n="products">Products</span>
    </a>
    <a href="#" class="bottom-nav-item" onclick="event.preventDefault(); toggleCart();">
      <span class="bottom-nav-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
        <span class="cart-badge" id="bottomCartBadge" style="display: none;">0</span>
      </span>
      <span data-i18n="cart">Cart</span>
    </a>
    <a href="history.html" class="bottom-nav-item">
      <span class="bottom-nav-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></span>
      <span data-i18n="my_history">History</span>
    </a>
  </nav>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>Clothing Store</h3>
        <p data-i18n="footer_desc">Your one-stop destination for fashion.</p>
      </div>
      <div class="footer-section">
        <h3 data-i18n="quick_links">Quick Links</h3>
        <ul class="footer-links">
          <li><a href="index.html" data-i18n="home">Home</a></li>
          <li><a href="store.html" data-i18n="products">Products</a></li>
          <li><a href="track-order.html" data-i18n="track_order">Track Order</a></li>
          <li><a href="wishlist.html" data-i18n="wishlist">Wishlist</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Clothing Store. All rights reserved.</p>
    </div>
  </footer>

  <!-- Cart Overlay -->
  <div class="cart-overlay" id="cartOverlay"></div>

  <!-- Cart Sidebar -->
  <div class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
      <h2 data-i18n="cart">Shopping Cart</h2>
      <button class="cart-close" id="cartClose">×</button>
    </div>
    <div class="cart-items" id="cartItemsContainer"></div>
    <div class="cart-footer" id="cartFooter">
      <div class="cart-total">
        <span class="cart-total-label" data-i18n="total">Total:</span>
        <span class="cart-total-amount" id="cartTotalAmount">$0</span>
      </div>
      <button class="checkout-btn" id="checkoutBtn" data-i18n="checkout">Proceed to Checkout</button>
    </div>
    
    <!-- Checkout Form (hidden by default) -->
    <div class="checkout-form" id="checkoutForm" style="display: none;">
      <div class="checkout-header">
        <button class="back-to-cart" id="backToCart" data-i18n="back_to_cart">← Back to Cart</button>
        <h3 data-i18n="checkout_title">Checkout</h3>
      </div>
      
      <div class="checkout-content">
        <form id="orderForm">
          <!-- Visual Order Summary -->
          <div class="order-summary-container" id="checkoutItemsList">
             <!-- Items injected via JS -->
          </div>

          <div class="form-group">
            <label for="checkoutName" data-i18n="full_name">Full Name *</label>
            <input type="text" id="checkoutName" name="name" placeholder="John Doe" required>
          </div>
          
          <div class="form-group">
            <label for="checkoutPhone" data-i18n="phone_number">Phone Number *</label>
            <input type="tel" id="checkoutPhone" name="phone" placeholder="0550 12 34 56" required>
          </div>
          
          <div class="form-group">
            <label for="checkoutWilaya" data-i18n="wilaya">Wilaya *</label>
            <select id="checkoutWilaya" name="wilaya" class="searchable" required>
              <option value="" data-i18n="select_wilaya">Select Wilaya</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="checkoutCommune" data-i18n="commune">Commune *</label>
            <select id="checkoutCommune" name="commune" class="searchable" required disabled>
              <option value="" data-i18n="select_commune">Select Commune</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="checkoutAddress" data-i18n="address">Address *</label>
            <textarea id="checkoutAddress" name="address" placeholder="Street, Building, Apartment..." rows="3" required></textarea>
          </div>

          <div class="checkout-totals">
             <div class="checkout-row">
               <span data-i18n="subtotal">Subtotal:</span>
               <span id="checkoutSubtotal">$0.00</span>
             </div>
             <div class="checkout-row total-row">
               <span data-i18n="total">Total:</span>
               <span id="checkoutFinalTotal">$0.00</span>
             </div>
          </div>
          
          <button type="submit" class="checkout-btn" data-i18n="place_order">Place Order</button>
        </form>
      </div>
    </div>
  </div>

  <script src="script.js?v=14"></script>
  <script>
    // Wishlist Page Logic
    document.addEventListener('DOMContentLoaded', () => {
      loadWishlistPage();
    });

    async function loadWishlistPage() {
      const grid = document.getElementById('wishlistGrid');
      const wishlist = JSON.parse(localStorage.getItem('clothingStoreWishlist') || '[]');

      if (wishlist.length === 0) {
        grid.innerHTML = `
          <div class="empty-wishlist" style="grid-column: 1/-1;">
            <h3 data-i18n="wishlist_empty">Your wishlist is empty</h3>
            <p data-i18n="wishlist_empty_desc">Save items you love to find them easily later.</p>
            <a href="store.html" class="btn-primary" data-i18n="start_shopping">Start Shopping</a>
          </div>
        `;
        // Re-run language loader to catch newly injected elements
        if (window.loadLanguage) {
          const currentLang = localStorage.getItem('preferredLanguage') || 'en';
          window.loadLanguage(currentLang);
        }
        return;
      }

      // Fetch fresh product data for discount info
      let products = [];
      try {
        const res = await fetch('/api/products');
        products = await res.json();
      } catch (e) {
        console.error('Failed to fetch products for wishlist', e);
      }

      const savedLang = localStorage.getItem('preferredLanguage') || 'en';
      const t = window.translations[savedLang] || window.translations['en'];
      grid.innerHTML = wishlist.map(p => {
        const nameEscaped = p.name.replace(/'/g, "\\'");
        // Find fresh product data for discount and quantity
        const freshProduct = products.find(prod => prod._id === p._id);
        const price = freshProduct?.price || p.price;
        const previousPrice = freshProduct?.previousPrice;
        const quantity = freshProduct?.quantity ?? p.quantity ?? 1;
        const isOut = quantity <= 0;
        
        let saleBadge = '';
        if (previousPrice && previousPrice > price) {
          const percent = Math.round(((previousPrice - price) / previousPrice) * 100);
          saleBadge = `<div class="sale-badge">-${percent}%</div>`;
        }

        const priceHTML = window.getPriceHTML ? window.getPriceHTML(price, previousPrice) : `$${price.toFixed(2)}`;
        
        return `
        <div class="product-card ${isOut ? 'out-of-stock' : ''}">
          <div class="product-image">
            ${saleBadge}
            <img src="${p.imageUrl || 'https://via.placeholder.com/300'}" alt="${p.name}">
            ${isOut ? `<span class="badge not-available" data-i18n="not_available">${t.not_available || 'Not Available'}</span>` : ''}
            <span class="product-badge">${p.category}</span>
            <button class="btn-wishlist active" onclick="event.stopPropagation(); toggleWishlist(this, '${p._id}', '${nameEscaped}', ${price}, '${p.imageUrl}', '${p.category}')">
              ♥
            </button>
          </div>
          <div class="product-info">
            <h3 class="product-title">${p.name}</h3>
            <p class="product-desc">${freshProduct?.description ? freshProduct.description.substring(0, 35) : 'Great quality product.'}...<a href="product.html?id=${p._id}" class="view-more" data-i18n="more">more</a></p>
            <div class="product-price">${priceHTML}</div>
            <div class="product-card-actions">
              <button class="btn-buy-now" onclick="window.location.href='product.html?id=${p._id}'" data-i18n="view_product" ${isOut ? 'disabled' : ''}>
                View Product
              </button>
              <button class="btn-add-cart" onclick="addToCart('${p._id}', '${nameEscaped}', ${price}, '${p.imageUrl}', 1)" data-i18n="add_to_cart_short" ${isOut ? 'disabled' : ''}>
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      `}).join('');

      // Re-run language loader to catch new static strings in cards
      if (window.loadLanguage) {
        const currentLang = localStorage.getItem('preferredLanguage') || 'en';
        window.loadLanguage(currentLang);
      }
    }

    // Override toggleWishlist to refresh page if removing item
    const originalToggle = window.toggleWishlist;
    window.toggleWishlist = function(btn, id, name, price, img, cat) {
      // Call original logic (which we will add to script.js shortly)
      // But for this page, we want to re-render if an item is removed
      
      let wishlist = JSON.parse(localStorage.getItem('clothingStoreWishlist') || '[]');
      const index = wishlist.findIndex(item => item._id === id);
      
      if (index !== -1) {
        // Removing
        wishlist.splice(index, 1);
        localStorage.setItem('clothingStoreWishlist', JSON.stringify(wishlist));
        showToast(`Removed ${name} from wishlist`);
        loadWishlistPage(); // Re-render
      } else {
        // Adding (unlikely on wishlist page but possible if logic changes)
        wishlist.push({ _id: id, name, price, imageUrl: img, category: cat });
        localStorage.setItem('clothingStoreWishlist', JSON.stringify(wishlist));
        showToast(`Added ${name} to wishlist`);
        loadWishlistPage();
      }
      updateWishlistCount();
    };
  </script>
</body>
</html>
